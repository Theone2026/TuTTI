(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();const m="http:/tutti:3000";async function b(){try{const t=await fetch(`${m}/api/recent-products`);if(!t.ok)throw new Error("Error al cargar los productos");return(await t.json()).filter(o=>o.status!=="archived"&&o.status!=="out_of_stock")}catch(t){return console.error("Error:",t),[]}}function c(t,e="USD"){const o=parseFloat(t),n=e==="USD"?"US$":"$",s=new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}).format(o);return`${n} ${s}`}function f(t){const e=document.getElementById("recent-products");e.innerHTML="";const o=t.filter(n=>!/EJEMPLO/i.test(n.name)&&n.stock>0);o.length>0?o.forEach(n=>{const s=c(n.price,n.currency||"USD"),r=n.images&&n.images.length>0?n.images[0]:"/img/default-product.jpg",a=`
                <div class="product-card bg-white rounded-lg overflow-hidden shadow-md flex flex-col h-full">
                    <a href="producto.html?id=${n._id}" class="block h-48 overflow-hidden">
                        <img src="${r}" alt="${n.name}" class="w-full h-full object-cover object-center" onerror="this.src='/img/default-product.jpg'">
                    </a>
                    <div class="p-4 flex-grow">
                        <h3 class="text-lg font-semibold mb-2">${n.name}</h3>
                        <p class="text-gray-600 mb-2">${n.description.substring(0,100)}...</p>
                        <p class="text-xl font-bold text-primary">${s}</p>
                    </div>
                    <div class="p-4 bg-gray-50">
                        <button onclick="addToCart('${n._id}')" class="w-full bg-primary text-white py-2 px-4 rounded hover:bg-blue-600 transition-colors">
                            Agregar al carrito
                        </button>
                    </div>
                </div>
            `;e.innerHTML+=a}):e.innerHTML="<p class='text-gray-600'>No hay productos para mostrar.</p>"}async function x(){try{const t=await fetch(`${m}/api/ofertas-del-dia`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=t.headers.get("content-type");if(!e||!e.includes("application/json")){const s=await t.text();throw console.log("Raw response for ofertas del día:",s),new Error("La respuesta del servidor no es JSON válido")}const o=await t.json(),n=document.getElementById("ofertas-del-dia");if(!n){console.error("Element with ID 'ofertas-del-dia' not found");return}n.innerHTML="",o.slice(0,3).forEach(s=>{n.innerHTML+=`
                <div class="flex items-center space-x-2">
                    <img src="${s.image}" alt="${s.name}" class="w-12 h-12 object-cover rounded">
                    <div>
                        <p class="text-sm font-semibold">${s.name}</p>
                        <p class="text-xs text-red-600">${c(s.price,s.currency)}</p>
                    </div>
                </div>
            `})}catch(t){console.error("Error al cargar ofertas del día:",t);const e=document.getElementById("ofertas-del-dia");e&&(e.innerHTML="<p>No se pudieron cargar las ofertas del día.</p>")}}async function E(){try{const t=await fetch(`${m}/api/nuevos-ingresos`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=t.headers.get("content-type");if(!e||!e.includes("application/json")){const s=await t.text();throw console.log("Raw response for nuevos ingresos:",s),new Error("La respuesta del servidor no es JSON válido")}const o=await t.json(),n=document.getElementById("nuevos-ingresos");if(!n){console.error("Element with ID 'nuevos-ingresos' not found");return}n.innerHTML="",o.slice(0,3).forEach(s=>{n.innerHTML+=`
                <div class="flex items-center space-x-2">
                    <img src="${s.image}" alt="${s.name}" class="w-12 h-12 object-cover rounded">
                    <div>
                        <p class="text-sm font-semibold">${s.name}</p>
                        <p class="text-xs text-gray-600">${c(s.price,s.currency)}</p>
                    </div>
                </div>
            `})}catch(t){console.error("Error al cargar nuevos ingresos:",t);const e=document.getElementById("nuevos-ingresos");e&&(e.innerHTML="<p>No se pudieron cargar los nuevos ingresos.</p>")}}function T(t,e){return t.filter(o=>o.category===e)}function y(t,e){return t.filter(o=>o.name.toLowerCase().includes(e.toLowerCase())||o.description.toLowerCase().includes(e.toLowerCase()))}async function L(){const t=localStorage.getItem("authToken"),e=document.getElementById("userDisplay"),o=document.getElementById("accountLink"),n=document.getElementById("sessionButtonContainer");if(!t){v(e,o,n);return}try{const s=await fetch(`${m}/api/user`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);const r=await s.json();I(r,e,o,n)}catch(s){console.error("Error:",s),v(e,o,n),localStorage.removeItem("authToken")}}function I(t,e,o,n){let s=localStorage.getItem("userName")||t.fullName||t.email.split("@")[0]||"Usuario";s=s.replace(/@.*$/,"");const r=`¡Hola, ${s}!`;if(e&&(e.textContent=r),o&&(o.innerHTML=`<i class="fas fa-user mr-1"></i><span>${r}</span>`,o.href="/dashboard.html"),n){n.innerHTML=`
            <a href="/cerrar_sesion.html" class="text-sm text-gray-600 hover:text-gray-800">Cerrar Sesión</a>
        `;const a=n.querySelector('a[href="/cerrar_sesion.html"]');a&&a.addEventListener("click",l=>{l.preventDefault(),k()})}}function v(t,e,o){t&&(t.textContent=""),e&&(e.innerHTML='<i class="fas fa-user mr-1"></i><span>Iniciar Sesión</span>',e.href="/login.html"),o&&(o.innerHTML="")}function $(t){try{const e=document.querySelector(".carousel");if(e&&t.length>0){e.innerHTML="",e.classList.add("relative","w-full","h-64","md:h-80","lg:h-96","overflow-hidden","rounded-lg","shadow-md"),t.slice(0,3).forEach((i,S)=>{const d=document.createElement("div");d.classList.add("absolute","inset-0","w-full","h-full","transition-opacity","duration-500"),d.style.opacity=S===0?"1":"0";const h=document.createElement("div");h.classList.add("relative","w-full","h-full");const u=document.createElement("img");u.src=i.images[0]||"/img/default-product.jpg",u.alt=i.name,u.classList.add("w-full","h-full","object-contain");const p=document.createElement("div");p.classList.add("absolute","bottom-0","left-0","right-0","bg-black","bg-opacity-50","text-white","p-4"),p.innerHTML=`
                    <h3 class="text-xl font-semibold mb-2">${i.name}</h3>
                    <p class="text-2xl font-bold">${c(i.price,i.currency)}</p>
                `,h.appendChild(u),h.appendChild(p),d.appendChild(h),e.appendChild(d)});const s=document.createElement("button");s.innerHTML="&#10094;",s.classList.add("absolute","top-1/2","left-4","transform","-translate-y-1/2","bg-white","bg-opacity-50","rounded-full","p-2","text-gray-800","hover:bg-opacity-75","text-2xl","z-10");const r=document.createElement("button");r.innerHTML="&#10095;",r.classList.add("absolute","top-1/2","right-4","transform","-translate-y-1/2","bg-white","bg-opacity-50","rounded-full","p-2","text-gray-800","hover:bg-opacity-75","text-2xl","z-10"),e.appendChild(s),e.appendChild(r);let a=0;const l=e.querySelectorAll('div[class^="absolute"]'),g=i=>{l[a].style.opacity="0",l[i].style.opacity="1",a=i};s.addEventListener("click",()=>{let i=a-1;i<0&&(i=l.length-1),g(i)}),r.addEventListener("click",()=>{let i=a+1;i>=l.length&&(i=0),g(i)}),setInterval(()=>{let i=a+1;i>=l.length&&(i=0),g(i)},5e3)}const o=document.querySelector(".ofertas-del-dia"),n=document.querySelector(".nuevos-ingresos");o&&n&&t.length>1&&(o.innerHTML=`
                <h3 class="text-sm font-semibold mb-2">Ofertas del Día</h3>
                <div class="bg-white p-2 rounded-lg shadow-sm">
                    <div class="w-full h-32 overflow-hidden">
                        <img src="${t[0].images[0]||"/img/default-product.jpg"}" alt="${t[0].name}" class="w-full h-full object-contain">
                    </div>
                    <p class="text-sm font-semibold mt-2 truncate">${t[0].name}</p>
                    <p class="text-base text-red-600 font-bold">${c(t[0].price,t[0].currency)}</p>
                </div>
            `,n.innerHTML=`
                <h3 class="text-sm font-semibold mb-2">Nuevos Ingresos</h3>
                <div class="bg-white p-2 rounded-lg shadow-sm">
                    <div class="w-full h-32 overflow-hidden">
                        <img src="${t[1].images[0]||"/img/default-product.jpg"}" alt="${t[1].name}" class="w-full h-full object-contain">
                    </div>
                    <p class="text-sm font-semibold mt-2 truncate">${t[1].name}</p>
                    <p class="text-base text-gray-600">${c(t[1].price,t[1].currency)}</p>
                </div>
            `)}catch(e){console.error("Error al cargar el Hero Banner:",e)}}document.addEventListener("DOMContentLoaded",async()=>{setupNotificationPanel(),await loadNotifications();const t=localStorage.getItem("userId"),e=new WebSocket("ws://localhost:3000");e.onopen=()=>{t&&e.send(JSON.stringify({type:"joinRoom",userId:t}))},e.onmessage=o=>{const n=JSON.parse(o.data);n.type==="notification"&&(console.log("Nueva notificación:",n.notification),handleNewNotification(n.notification))}});window.handleNotificationClick=handleNotificationClick;document.addEventListener("DOMContentLoaded",async()=>{const t=await b();$(t),f(t),L(),x(),E(),document.querySelectorAll("[data-category]").forEach(s=>{s.addEventListener("click",()=>{const r=s.getAttribute("data-category"),a=T(t,r);f(a)})});const o=document.getElementById("searchInput");document.getElementById("searchButton").addEventListener("click",()=>{const s=o.value.trim(),r=y(t,s);f(r)}),o.addEventListener("keyup",s=>{if(s.key==="Enter"){const r=o.value.trim(),a=y(t,r);f(a)}})});function k(){localStorage.removeItem("authToken"),localStorage.removeItem("userId"),localStorage.removeItem("userInfo"),window.location.href="/login.html"}class w{constructor(e,o={}){if(this.container=document.querySelector(e),!this.container)return;const n={slidesToShow:4,slidesToScroll:1,infinite:!0,autoplay:!0,autoplaySpeed:3e3,responsive:[{breakpoint:1024,settings:{slidesToShow:3}},{breakpoint:768,settings:{slidesToShow:2}},{breakpoint:480,settings:{slidesToShow:1}}]};this.settings={...n,...o},this.slides=this.container.querySelectorAll(".product-card"),this.currentIndex=0,this.touchStartX=0,this.touchEndX=0,this.interval=null,this.init()}init(){this.slides.length<=this.settings.slidesToShow||(this.setupSlider(),this.setupResponsive(),this.settings.autoplay&&this.startAutoplay(),this.container.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.container.addEventListener("touchend",this.handleTouchEnd.bind(this)))}setupSlider(){this.container.style.overflow="hidden",this.container.style.position="relative";const e=document.createElement("div");e.className="slider-track",e.style.display="flex",e.style.transition="transform 0.5s ease",this.slides.forEach(o=>{e.appendChild(o.cloneNode(!0)),o.remove()}),this.container.appendChild(e),this.track=e,this.updateSlider()}updateSlider(){const e=100/this.settings.slidesToShow;this.track.style.width=`${this.slides.length*100}%`,Array.from(this.track.children).forEach(o=>{o.style.minWidth=`${e}%`}),this.moveToSlide(this.currentIndex)}moveToSlide(e){e<0?e=this.settings.infinite?this.slides.length-1:0:e>=this.slides.length&&(e=this.settings.infinite?0:this.slides.length-this.settings.slidesToShow),this.currentIndex=e;const o=-e*(100/this.slides.length)*this.settings.slidesToShow;this.track.style.transform=`translateX(${o}%)`}nextSlide(){this.moveToSlide(this.currentIndex+this.settings.slidesToScroll)}prevSlide(){this.moveToSlide(this.currentIndex-this.settings.slidesToScroll)}handleTouchStart(e){this.touchStartX=e.changedTouches[0].screenX,this.interval&&clearInterval(this.interval)}handleTouchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.handleSwipe(),this.settings.autoplay&&this.startAutoplay()}handleSwipe(){this.touchStartX-this.touchEndX>50?this.nextSlide():this.touchEndX-this.touchStartX>50&&this.prevSlide()}startAutoplay(){this.interval&&clearInterval(this.interval),this.interval=setInterval(()=>{this.nextSlide()},this.settings.autoplaySpeed)}setupResponsive(){const e=()=>{const o=window.innerWidth;let n={...this.settings};this.settings.responsive.forEach(s=>{o<=s.breakpoint&&(n={...n,...s.settings})}),this.settings=n,this.updateSlider()};window.addEventListener("resize",e),e()}}document.addEventListener("DOMContentLoaded",()=>{new w("#featured-products",{autoplay:!0,autoplaySpeed:5e3}),new w("#special-offers",{slidesToShow:3,autoplay:!1})});
